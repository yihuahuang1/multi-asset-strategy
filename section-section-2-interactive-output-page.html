<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 2 Interactive Output Page | shinyapptest.knit</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.38 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 2 Interactive Output Page | shinyapptest.knit" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 2 Interactive Output Page | shinyapptest.knit" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  




<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Multi-Asset Portfolio Strategy</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path=""><a href="#section-section-2-interactive-output-page"><i class="fa fa-check"></i>Section 2 Interactive Output Page</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:title:end-->
<!--bookdown:title:start-->
<div id="section-section-2-interactive-output-page" class="section level1 unnumbered hasAnchor">
<h1>Section 2 Interactive Output Page<a href="#section-section-2-interactive-output-page" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>#<a href="https://rstudio.github.io/DT/" class="uri">https://rstudio.github.io/DT/</a>
#<a href="https://bookdown.org/yihui/rmarkdown/shiny-deploy.html#shinyapps.io" class="uri">https://bookdown.org/yihui/rmarkdown/shiny-deploy.html#shinyapps.io</a></p>
<div class="sourceCode" id="section-cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb1-1"><a href="#section-cb1-1" tabindex="-1"></a><span class="co"># Data Intake</span></span>
<span id="section-cb1-2"><a href="#section-cb1-2" tabindex="-1"></a>mega7data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;mega7tidy.csv&quot;</span>)</span>
<span id="section-cb1-3"><a href="#section-cb1-3" tabindex="-1"></a>mega7mcap <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;mega7marketcap.csv&quot;</span>)</span>
<span id="section-cb1-4"><a href="#section-cb1-4" tabindex="-1"></a></span>
<span id="section-cb1-5"><a href="#section-cb1-5" tabindex="-1"></a>mega7data_modified <span class="ot">&lt;-</span> </span>
<span id="section-cb1-6"><a href="#section-cb1-6" tabindex="-1"></a>  mega7data <span class="sc">%&gt;%</span></span>
<span id="section-cb1-7"><a href="#section-cb1-7" tabindex="-1"></a>  <span class="fu">inner_join</span>(mega7mcap, <span class="fu">join_by</span>(symbol <span class="sc">==</span> Stock)) <span class="sc">%&gt;%</span></span>
<span id="section-cb1-8"><a href="#section-cb1-8" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">marketcap =</span> Marketcap) <span class="sc">%&gt;%</span></span>
<span id="section-cb1-9"><a href="#section-cb1-9" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>X.x) <span class="sc">%&gt;%</span> </span>
<span id="section-cb1-10"><a href="#section-cb1-10" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>X.y) </span>
<span id="section-cb1-11"><a href="#section-cb1-11" tabindex="-1"></a>mega7data_modified<span class="sc">$</span>marketcap <span class="ot">&lt;-</span> <span class="fu">round</span>(mega7data_modified<span class="sc">$</span>marketcap, <span class="dv">0</span>)</span></code></pre></div>
<div class="sourceCode" id="section-cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb2-1"><a href="#section-cb2-1" tabindex="-1"></a><span class="co"># Define UI</span></span>
<span id="section-cb2-2"><a href="#section-cb2-2" tabindex="-1"></a>ui22 <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="section-cb2-3"><a href="#section-cb2-3" tabindex="-1"></a>    <span class="fu">titlePanel</span>(<span class="st">&quot;Section 2 Interactive Output Webpage 第二部分交互结果展示&quot;</span>),</span>
<span id="section-cb2-4"><a href="#section-cb2-4" tabindex="-1"></a>    </span>
<span id="section-cb2-5"><a href="#section-cb2-5" tabindex="-1"></a>    </span>
<span id="section-cb2-6"><a href="#section-cb2-6" tabindex="-1"></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="section-cb2-7"><a href="#section-cb2-7" tabindex="-1"></a>        <span class="fu">sidebarPanel</span>(</span>
<span id="section-cb2-8"><a href="#section-cb2-8" tabindex="-1"></a>            <span class="fu">selectInput</span>(<span class="st">&quot;symbol&quot;</span>, <span class="st">&quot;Symbol&quot;</span>, <span class="at">choices =</span> <span class="fu">unique</span>(mega7data_modified<span class="sc">$</span>symbol)),</span>
<span id="section-cb2-9"><a href="#section-cb2-9" tabindex="-1"></a>            <span class="fu">dateRangeInput</span>(<span class="st">&quot;dateRange&quot;</span>, <span class="st">&quot;Date Range&quot;</span>, </span>
<span id="section-cb2-10"><a href="#section-cb2-10" tabindex="-1"></a>                           <span class="at">start =</span> <span class="fu">min</span>(mega7data_modified<span class="sc">$</span>date), <span class="at">end =</span> <span class="fu">max</span>(mega7data_modified<span class="sc">$</span>date)),</span>
<span id="section-cb2-11"><a href="#section-cb2-11" tabindex="-1"></a>            <span class="fu">checkboxGroupInput</span>(<span class="st">&quot;variables&quot;</span>, <span class="st">&quot;Variables&quot;</span>, </span>
<span id="section-cb2-12"><a href="#section-cb2-12" tabindex="-1"></a>                               <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">&quot;adjusted&quot;</span> <span class="ot">=</span> <span class="st">&quot;adjusted&quot;</span>, <span class="st">&quot;high&quot;</span>, <span class="st">&quot;low&quot;</span>,<span class="st">&quot;open&quot;</span>, <span class="st">&quot;close&quot;</span>,</span>
<span id="section-cb2-13"><a href="#section-cb2-13" tabindex="-1"></a>                                           <span class="st">&quot;volume&quot;</span><span class="ot">=</span><span class="st">&quot;volume&quot;</span>,<span class="st">&quot;market cap (USD)&quot;</span><span class="ot">=</span><span class="st">&quot;marketcap&quot;</span>),</span>
<span id="section-cb2-14"><a href="#section-cb2-14" tabindex="-1"></a>                               <span class="at">selected =</span> <span class="fu">c</span>(<span class="st">&quot;adjusted&quot;</span>,<span class="st">&quot;volume&quot;</span>))</span>
<span id="section-cb2-15"><a href="#section-cb2-15" tabindex="-1"></a>        ),</span>
<span id="section-cb2-16"><a href="#section-cb2-16" tabindex="-1"></a>        <span class="fu">mainPanel</span>(</span>
<span id="section-cb2-17"><a href="#section-cb2-17" tabindex="-1"></a>          <span class="fu">tabsetPanel</span>(</span>
<span id="section-cb2-18"><a href="#section-cb2-18" tabindex="-1"></a>            <span class="fu">tabPanel</span>(<span class="st">&quot;Data Table 数据&quot;</span>, <span class="fu">DTOutput</span>(<span class="st">&quot;table&quot;</span>)),</span>
<span id="section-cb2-19"><a href="#section-cb2-19" tabindex="-1"></a>            <span class="fu">tabPanel</span>(<span class="st">&quot;Price Chart 股价&quot;</span>, <span class="fu">plotlyOutput</span>(<span class="st">&quot;pricePlot&quot;</span>)),</span>
<span id="section-cb2-20"><a href="#section-cb2-20" tabindex="-1"></a>            <span class="fu">tabPanel</span>(<span class="st">&quot;Volume Chart 交易量&quot;</span>, <span class="fu">plotlyOutput</span>(<span class="st">&quot;volumePlot&quot;</span>))</span>
<span id="section-cb2-21"><a href="#section-cb2-21" tabindex="-1"></a>          ),</span>
<span id="section-cb2-22"><a href="#section-cb2-22" tabindex="-1"></a>          <span class="fu">verbatimTextOutput</span>(<span class="st">&quot;graphDescription1&quot;</span>),</span>
<span id="section-cb2-23"><a href="#section-cb2-23" tabindex="-1"></a>          <span class="fu">verbatimTextOutput</span>(<span class="st">&quot;graphDescription2&quot;</span>)  <span class="co"># Text output for graph description</span></span>
<span id="section-cb2-24"><a href="#section-cb2-24" tabindex="-1"></a>        )</span>
<span id="section-cb2-25"><a href="#section-cb2-25" tabindex="-1"></a>    )</span>
<span id="section-cb2-26"><a href="#section-cb2-26" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="section-cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb3-1"><a href="#section-cb3-1" tabindex="-1"></a><span class="co"># Define server logic</span></span>
<span id="section-cb3-2"><a href="#section-cb3-2" tabindex="-1"></a>server22 <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="section-cb3-3"><a href="#section-cb3-3" tabindex="-1"></a>    <span class="co"># Reactive expression for filtered data for the table</span></span>
<span id="section-cb3-4"><a href="#section-cb3-4" tabindex="-1"></a>    filteredData <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="section-cb3-5"><a href="#section-cb3-5" tabindex="-1"></a>        <span class="fu">req</span>(input<span class="sc">$</span>symbol, input<span class="sc">$</span>dateRange)</span>
<span id="section-cb3-6"><a href="#section-cb3-6" tabindex="-1"></a>        mega7data_modified <span class="sc">%&gt;%</span></span>
<span id="section-cb3-7"><a href="#section-cb3-7" tabindex="-1"></a>            <span class="fu">filter</span>(symbol <span class="sc">==</span> input<span class="sc">$</span>symbol, date <span class="sc">&gt;=</span> input<span class="sc">$</span>dateRange[<span class="dv">1</span>], </span>
<span id="section-cb3-8"><a href="#section-cb3-8" tabindex="-1"></a>                   date <span class="sc">&lt;=</span> input<span class="sc">$</span>dateRange[<span class="dv">2</span>]) <span class="sc">%&gt;%</span></span>
<span id="section-cb3-9"><a href="#section-cb3-9" tabindex="-1"></a>            <span class="fu">select</span>(date, symbol, <span class="fu">all_of</span>(input<span class="sc">$</span>variables)) <span class="sc">%&gt;%</span></span>
<span id="section-cb3-10"><a href="#section-cb3-10" tabindex="-1"></a>          <span class="fu">arrange</span>(<span class="fu">desc</span>(date))</span>
<span id="section-cb3-11"><a href="#section-cb3-11" tabindex="-1"></a>    })</span>
<span id="section-cb3-12"><a href="#section-cb3-12" tabindex="-1"></a>    <span class="co"># Reactive expression for filtered data for the graphs</span></span>
<span id="section-cb3-13"><a href="#section-cb3-13" tabindex="-1"></a>  filteredGraphData <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="section-cb3-14"><a href="#section-cb3-14" tabindex="-1"></a>    <span class="fu">req</span>(input<span class="sc">$</span>symbol, input<span class="sc">$</span>dateRange)</span>
<span id="section-cb3-15"><a href="#section-cb3-15" tabindex="-1"></a>    data <span class="ot">&lt;-</span> mega7data_modified <span class="sc">%&gt;%</span></span>
<span id="section-cb3-16"><a href="#section-cb3-16" tabindex="-1"></a>      <span class="fu">filter</span>(symbol <span class="sc">==</span> input<span class="sc">$</span>symbol, date <span class="sc">&gt;=</span> input<span class="sc">$</span>dateRange[<span class="dv">1</span>], date <span class="sc">&lt;=</span> input<span class="sc">$</span>dateRange[<span class="dv">2</span>]) <span class="sc">%&gt;%</span></span>
<span id="section-cb3-17"><a href="#section-cb3-17" tabindex="-1"></a>      <span class="fu">select</span>(date, adjusted, volume, high, low, open)  <span class="co"># Always include price and volume for the graphs</span></span>
<span id="section-cb3-18"><a href="#section-cb3-18" tabindex="-1"></a>    data<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(data<span class="sc">$</span>date)</span>
<span id="section-cb3-19"><a href="#section-cb3-19" tabindex="-1"></a>    data</span>
<span id="section-cb3-20"><a href="#section-cb3-20" tabindex="-1"></a>    })</span>
<span id="section-cb3-21"><a href="#section-cb3-21" tabindex="-1"></a>    <span class="co"># Render the table</span></span>
<span id="section-cb3-22"><a href="#section-cb3-22" tabindex="-1"></a>    output<span class="sc">$</span>table <span class="ot">&lt;-</span> <span class="fu">renderDT</span>({</span>
<span id="section-cb3-23"><a href="#section-cb3-23" tabindex="-1"></a>      <span class="fu">datatable</span>(</span>
<span id="section-cb3-24"><a href="#section-cb3-24" tabindex="-1"></a>        <span class="fu">filteredData</span>(), </span>
<span id="section-cb3-25"><a href="#section-cb3-25" tabindex="-1"></a>        <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>, <span class="at">autoWidth =</span> <span class="cn">TRUE</span>),</span>
<span id="section-cb3-26"><a href="#section-cb3-26" tabindex="-1"></a>        <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(<span class="at">style =</span> <span class="st">&quot;caption-side: top; font-size: 180%;&quot;</span>,</span>
<span id="section-cb3-27"><a href="#section-cb3-27" tabindex="-1"></a>                                          <span class="st">&quot;Stock Price/Volume Data (raw) 原始量价数据&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="section-cb3-28"><a href="#section-cb3-28" tabindex="-1"></a>        <span class="fu">formatRound</span>(<span class="at">columns =</span> <span class="fu">which</span>(<span class="fu">names</span>(<span class="fu">filteredData</span>()) <span class="sc">%in%</span> input<span class="sc">$</span>variables), <span class="at">digits =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="section-cb3-29"><a href="#section-cb3-29" tabindex="-1"></a>        <span class="fu">formatStyle</span>(<span class="st">&quot;volume&quot;</span>, <span class="at">fontWeight =</span> <span class="st">&quot;bold&quot;</span>,</span>
<span id="section-cb3-30"><a href="#section-cb3-30" tabindex="-1"></a>                    <span class="st">`</span><span class="at">data-thousands</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;,&quot;</span>, <span class="st">`</span><span class="at">data-type</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;formatted-num&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="section-cb3-31"><a href="#section-cb3-31" tabindex="-1"></a>        <span class="fu">formatRound</span>(<span class="at">columns =</span> <span class="fu">which</span>(<span class="fu">names</span>(<span class="fu">filteredData</span>()) <span class="sc">==</span> <span class="st">&quot;volume&quot;</span>), <span class="at">digits =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="section-cb3-32"><a href="#section-cb3-32" tabindex="-1"></a>        <span class="fu">formatStyle</span>(<span class="st">&quot;adjusted&quot;</span>, <span class="at">fontWeight =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="section-cb3-33"><a href="#section-cb3-33" tabindex="-1"></a>    })</span>
<span id="section-cb3-34"><a href="#section-cb3-34" tabindex="-1"></a>  <span class="co"># Render the plot</span></span>
<span id="section-cb3-35"><a href="#section-cb3-35" tabindex="-1"></a>    output<span class="sc">$</span>pricePlot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="section-cb3-36"><a href="#section-cb3-36" tabindex="-1"></a>        data <span class="ot">&lt;-</span> <span class="fu">filteredGraphData</span>()</span>
<span id="section-cb3-37"><a href="#section-cb3-37" tabindex="-1"></a>        <span class="fu">print</span>(data)</span>
<span id="section-cb3-38"><a href="#section-cb3-38" tabindex="-1"></a>        <span class="co"># Constructing the graph </span></span>
<span id="section-cb3-39"><a href="#section-cb3-39" tabindex="-1"></a>        p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> adjusted,</span>
<span id="section-cb3-40"><a href="#section-cb3-40" tabindex="-1"></a>                      <span class="at">text =</span> <span class="fu">paste</span>(<span class="st">&quot;Date: &quot;</span>, date, <span class="st">&quot;&lt;br&gt;&quot;</span>,</span>
<span id="section-cb3-41"><a href="#section-cb3-41" tabindex="-1"></a>                                   <span class="st">&quot;Adjusted Close: &quot;</span>, adjusted, <span class="st">&quot;&lt;br&gt;&quot;</span>,</span>
<span id="section-cb3-42"><a href="#section-cb3-42" tabindex="-1"></a>                                   <span class="st">&quot;Open: &quot;</span>, open, <span class="st">&quot;&lt;br&gt;&quot;</span>,</span>
<span id="section-cb3-43"><a href="#section-cb3-43" tabindex="-1"></a>                                   <span class="st">&quot;High: &quot;</span>, high, <span class="st">&quot;&lt;br&gt;&quot;</span>,</span>
<span id="section-cb3-44"><a href="#section-cb3-44" tabindex="-1"></a>                                   <span class="st">&quot;Low: &quot;</span>, low, <span class="st">&quot;&lt;br&gt;&quot;</span>,</span>
<span id="section-cb3-45"><a href="#section-cb3-45" tabindex="-1"></a>                                   <span class="st">&quot;Volume: &quot;</span>, volume))) <span class="sc">+</span></span>
<span id="section-cb3-46"><a href="#section-cb3-46" tabindex="-1"></a>            <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&#39;green&#39;</span>) <span class="sc">+</span></span>
<span id="section-cb3-47"><a href="#section-cb3-47" tabindex="-1"></a>            <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">&quot;3 month&quot;</span>, <span class="at">date_labels =</span> <span class="st">&quot;%b %Y&quot;</span>) <span class="sc">+</span></span>
<span id="section-cb3-48"><a href="#section-cb3-48" tabindex="-1"></a>            <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">&quot;Stock Price for&quot;</span>, input<span class="sc">$</span>symbol, <span class="st">&quot;US Equity: 日收盘价&quot;</span>)) <span class="sc">+</span></span>
<span id="section-cb3-49"><a href="#section-cb3-49" tabindex="-1"></a>            <span class="fu">xlab</span>(<span class="st">&quot;Date 日期&quot;</span>) <span class="sc">+</span> </span>
<span id="section-cb3-50"><a href="#section-cb3-50" tabindex="-1"></a>            <span class="fu">ylab</span>(<span class="st">&quot;Adjusted Close Price (USD) 日收盘价&quot;</span>) <span class="sc">+</span> </span>
<span id="section-cb3-51"><a href="#section-cb3-51" tabindex="-1"></a>            <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="section-cb3-52"><a href="#section-cb3-52" tabindex="-1"></a>            <span class="fu">theme_bw</span>()</span>
<span id="section-cb3-53"><a href="#section-cb3-53" tabindex="-1"></a></span>
<span id="section-cb3-54"><a href="#section-cb3-54" tabindex="-1"></a>        <span class="fu">ggplotly</span>(p, <span class="at">tooltip =</span> <span class="st">&quot;text&quot;</span>)</span>
<span id="section-cb3-55"><a href="#section-cb3-55" tabindex="-1"></a>    })</span>
<span id="section-cb3-56"><a href="#section-cb3-56" tabindex="-1"></a>    output<span class="sc">$</span>volumePlot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="section-cb3-57"><a href="#section-cb3-57" tabindex="-1"></a>        data <span class="ot">&lt;-</span> <span class="fu">filteredGraphData</span>()</span>
<span id="section-cb3-58"><a href="#section-cb3-58" tabindex="-1"></a>        <span class="fu">req</span>(data<span class="sc">$</span>volume)</span>
<span id="section-cb3-59"><a href="#section-cb3-59" tabindex="-1"></a></span>
<span id="section-cb3-60"><a href="#section-cb3-60" tabindex="-1"></a>        v <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> volume)) <span class="sc">+</span></span>
<span id="section-cb3-61"><a href="#section-cb3-61" tabindex="-1"></a>            <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>, <span class="at">fill =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span></span>
<span id="section-cb3-62"><a href="#section-cb3-62" tabindex="-1"></a>            <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">&quot;2 month&quot;</span>, <span class="at">date_labels =</span> <span class="st">&quot;%b %Y&quot;</span>) <span class="sc">+</span></span>
<span id="section-cb3-63"><a href="#section-cb3-63" tabindex="-1"></a>            <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">&quot;Volume for&quot;</span>, input<span class="sc">$</span>symbol, <span class="st">&quot;US Equity: 日交易量&quot;</span>)) <span class="sc">+</span></span>
<span id="section-cb3-64"><a href="#section-cb3-64" tabindex="-1"></a>            <span class="fu">xlab</span>(<span class="st">&quot;Date 日期&quot;</span>) <span class="sc">+</span></span>
<span id="section-cb3-65"><a href="#section-cb3-65" tabindex="-1"></a>            <span class="fu">ylab</span>(<span class="st">&quot;Volume in USD 日交易量&quot;</span>) <span class="sc">+</span></span>
<span id="section-cb3-66"><a href="#section-cb3-66" tabindex="-1"></a>            <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="section-cb3-67"><a href="#section-cb3-67" tabindex="-1"></a>            <span class="fu">theme_minimal</span>()</span>
<span id="section-cb3-68"><a href="#section-cb3-68" tabindex="-1"></a></span>
<span id="section-cb3-69"><a href="#section-cb3-69" tabindex="-1"></a>        <span class="fu">ggplotly</span>(v)</span>
<span id="section-cb3-70"><a href="#section-cb3-70" tabindex="-1"></a>    })</span>
<span id="section-cb3-71"><a href="#section-cb3-71" tabindex="-1"></a>  <span class="co"># Render the graph description text</span></span>
<span id="section-cb3-72"><a href="#section-cb3-72" tabindex="-1"></a>  output<span class="sc">$</span>graphDescription1 <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="section-cb3-73"><a href="#section-cb3-73" tabindex="-1"></a><span class="st">&quot;1. Circle on the plot will zoom in to the selected period.&quot;</span></span>
<span id="section-cb3-74"><a href="#section-cb3-74" tabindex="-1"></a>  })</span>
<span id="section-cb3-75"><a href="#section-cb3-75" tabindex="-1"></a>  output<span class="sc">$</span>graphDescription2 <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="section-cb3-76"><a href="#section-cb3-76" tabindex="-1"></a><span class="st">&quot;2. Double click on the plot to restore axis.&quot;</span></span>
<span id="section-cb3-77"><a href="#section-cb3-77" tabindex="-1"></a>  })</span>
<span id="section-cb3-78"><a href="#section-cb3-78" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="section-cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb4-1"><a href="#section-cb4-1" tabindex="-1"></a><span class="co"># Run the application </span></span>
<span id="section-cb4-2"><a href="#section-cb4-2" tabindex="-1"></a><span class="fu">shinyApp</span>(ui22, server22)</span></code></pre></div>
<iframe data-deferred-src="app6d48c41d57f0001a689bc1e92e67602b/?w=&amp;__subapp__=1" width="100%" height="400" class="shiny-frame shiny-frame-deferred"></iframe>
<div class="sourceCode" id="section-cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb5-1"><a href="#section-cb5-1" tabindex="-1"></a>server22 <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="section-cb5-2"><a href="#section-cb5-2" tabindex="-1"></a>  <span class="co"># Reactive expression for filtered data for the table</span></span>
<span id="section-cb5-3"><a href="#section-cb5-3" tabindex="-1"></a>  filteredData <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="section-cb5-4"><a href="#section-cb5-4" tabindex="-1"></a>    <span class="fu">req</span>(input<span class="sc">$</span>symbol, input<span class="sc">$</span>dateRange)</span>
<span id="section-cb5-5"><a href="#section-cb5-5" tabindex="-1"></a>    data <span class="ot">&lt;-</span> mega7data_modified <span class="sc">%&gt;%</span></span>
<span id="section-cb5-6"><a href="#section-cb5-6" tabindex="-1"></a>      <span class="fu">filter</span>(symbol <span class="sc">==</span> input<span class="sc">$</span>symbol, date <span class="sc">&gt;=</span> input<span class="sc">$</span>dateRange[<span class="dv">1</span>], date <span class="sc">&lt;=</span> input<span class="sc">$</span>dateRange[<span class="dv">2</span>]) <span class="sc">%&gt;%</span></span>
<span id="section-cb5-7"><a href="#section-cb5-7" tabindex="-1"></a>      <span class="fu">select</span>(date, symbol, <span class="fu">all_of</span>(input<span class="sc">$</span>variables)) <span class="sc">%&gt;%</span></span>
<span id="section-cb5-8"><a href="#section-cb5-8" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(date))</span>
<span id="section-cb5-9"><a href="#section-cb5-9" tabindex="-1"></a>    <span class="fu">print</span>(data) <span class="co"># Debugging statement</span></span>
<span id="section-cb5-10"><a href="#section-cb5-10" tabindex="-1"></a>    data</span>
<span id="section-cb5-11"><a href="#section-cb5-11" tabindex="-1"></a>  })</span>
<span id="section-cb5-12"><a href="#section-cb5-12" tabindex="-1"></a>  </span>
<span id="section-cb5-13"><a href="#section-cb5-13" tabindex="-1"></a>  <span class="co"># Reactive expression for filtered data for the graphs</span></span>
<span id="section-cb5-14"><a href="#section-cb5-14" tabindex="-1"></a>  filteredGraphData <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="section-cb5-15"><a href="#section-cb5-15" tabindex="-1"></a>    <span class="fu">req</span>(input<span class="sc">$</span>symbol, input<span class="sc">$</span>dateRange)</span>
<span id="section-cb5-16"><a href="#section-cb5-16" tabindex="-1"></a>    data <span class="ot">&lt;-</span> mega7data_modified <span class="sc">%&gt;%</span></span>
<span id="section-cb5-17"><a href="#section-cb5-17" tabindex="-1"></a>      <span class="fu">filter</span>(symbol <span class="sc">==</span> input<span class="sc">$</span>symbol, date <span class="sc">&gt;=</span> input<span class="sc">$</span>dateRange[<span class="dv">1</span>], date <span class="sc">&lt;=</span> input<span class="sc">$</span>dateRange[<span class="dv">2</span>]) <span class="sc">%&gt;%</span></span>
<span id="section-cb5-18"><a href="#section-cb5-18" tabindex="-1"></a>      <span class="fu">select</span>(date, adjusted, volume, high, low, open)  <span class="co"># Always include price and volume for the graphs</span></span>
<span id="section-cb5-19"><a href="#section-cb5-19" tabindex="-1"></a>    data<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(data<span class="sc">$</span>date)</span>
<span id="section-cb5-20"><a href="#section-cb5-20" tabindex="-1"></a>    <span class="fu">print</span>(data) <span class="co"># Debugging statement</span></span>
<span id="section-cb5-21"><a href="#section-cb5-21" tabindex="-1"></a>    data</span>
<span id="section-cb5-22"><a href="#section-cb5-22" tabindex="-1"></a>  })</span>
<span id="section-cb5-23"><a href="#section-cb5-23" tabindex="-1"></a>  </span>
<span id="section-cb5-24"><a href="#section-cb5-24" tabindex="-1"></a>  <span class="co"># Render the table</span></span>
<span id="section-cb5-25"><a href="#section-cb5-25" tabindex="-1"></a>  output<span class="sc">$</span>table <span class="ot">&lt;-</span> <span class="fu">renderDT</span>({</span>
<span id="section-cb5-26"><a href="#section-cb5-26" tabindex="-1"></a>    <span class="fu">datatable</span>(</span>
<span id="section-cb5-27"><a href="#section-cb5-27" tabindex="-1"></a>      <span class="fu">filteredData</span>(), </span>
<span id="section-cb5-28"><a href="#section-cb5-28" tabindex="-1"></a>      <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>, <span class="at">autoWidth =</span> <span class="cn">TRUE</span>),</span>
<span id="section-cb5-29"><a href="#section-cb5-29" tabindex="-1"></a>      <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(<span class="at">style =</span> <span class="st">&quot;caption-side: top; font-size: 180%;&quot;</span>,</span>
<span id="section-cb5-30"><a href="#section-cb5-30" tabindex="-1"></a>                                        <span class="st">&quot;Stock Price/Volume Data (raw) 原始量价数据&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="section-cb5-31"><a href="#section-cb5-31" tabindex="-1"></a>      <span class="fu">formatRound</span>(<span class="at">columns =</span> <span class="fu">which</span>(<span class="fu">names</span>(<span class="fu">filteredData</span>()) <span class="sc">%in%</span> input<span class="sc">$</span>variables), <span class="at">digits =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="section-cb5-32"><a href="#section-cb5-32" tabindex="-1"></a>      <span class="fu">formatStyle</span>(<span class="st">&quot;volume&quot;</span>, <span class="at">fontWeight =</span> <span class="st">&quot;bold&quot;</span>,</span>
<span id="section-cb5-33"><a href="#section-cb5-33" tabindex="-1"></a>                  <span class="st">`</span><span class="at">data-thousands</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;,&quot;</span>, <span class="st">`</span><span class="at">data-type</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;formatted-num&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="section-cb5-34"><a href="#section-cb5-34" tabindex="-1"></a>      <span class="fu">formatRound</span>(<span class="at">columns =</span> <span class="fu">which</span>(<span class="fu">names</span>(<span class="fu">filteredData</span>()) <span class="sc">==</span> <span class="st">&quot;volume&quot;</span>), <span class="at">digits =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="section-cb5-35"><a href="#section-cb5-35" tabindex="-1"></a>      <span class="fu">formatStyle</span>(<span class="st">&quot;adjusted&quot;</span>, <span class="at">fontWeight =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="section-cb5-36"><a href="#section-cb5-36" tabindex="-1"></a>  })</span>
<span id="section-cb5-37"><a href="#section-cb5-37" tabindex="-1"></a>  </span>
<span id="section-cb5-38"><a href="#section-cb5-38" tabindex="-1"></a>  <span class="co"># Render the plot</span></span>
<span id="section-cb5-39"><a href="#section-cb5-39" tabindex="-1"></a>  output<span class="sc">$</span>pricePlot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="section-cb5-40"><a href="#section-cb5-40" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">filteredGraphData</span>()</span>
<span id="section-cb5-41"><a href="#section-cb5-41" tabindex="-1"></a>    <span class="fu">print</span>(data) <span class="co"># Debugging statement</span></span>
<span id="section-cb5-42"><a href="#section-cb5-42" tabindex="-1"></a></span>
<span id="section-cb5-43"><a href="#section-cb5-43" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> adjusted)) <span class="sc">+</span></span>
<span id="section-cb5-44"><a href="#section-cb5-44" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&#39;green&#39;</span>) <span class="sc">+</span></span>
<span id="section-cb5-45"><a href="#section-cb5-45" tabindex="-1"></a>      <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">&quot;3 month&quot;</span>, <span class="at">date_labels =</span> <span class="st">&quot;%b %Y&quot;</span>) <span class="sc">+</span></span>
<span id="section-cb5-46"><a href="#section-cb5-46" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">&quot;Stock Price for&quot;</span>, input<span class="sc">$</span>symbol, <span class="st">&quot;US Equity: 日收盘价&quot;</span>)) <span class="sc">+</span></span>
<span id="section-cb5-47"><a href="#section-cb5-47" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">&quot;Date 日期&quot;</span>) <span class="sc">+</span> </span>
<span id="section-cb5-48"><a href="#section-cb5-48" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">&quot;Adjusted Close Price (USD) 日收盘价&quot;</span>) <span class="sc">+</span> </span>
<span id="section-cb5-49"><a href="#section-cb5-49" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="section-cb5-50"><a href="#section-cb5-50" tabindex="-1"></a>      <span class="fu">theme_bw</span>()</span>
<span id="section-cb5-51"><a href="#section-cb5-51" tabindex="-1"></a></span>
<span id="section-cb5-52"><a href="#section-cb5-52" tabindex="-1"></a>    <span class="fu">ggplotly</span>(p)</span>
<span id="section-cb5-53"><a href="#section-cb5-53" tabindex="-1"></a>  })</span>
<span id="section-cb5-54"><a href="#section-cb5-54" tabindex="-1"></a>  </span>
<span id="section-cb5-55"><a href="#section-cb5-55" tabindex="-1"></a>  <span class="co"># Render the graph description text</span></span>
<span id="section-cb5-56"><a href="#section-cb5-56" tabindex="-1"></a>  output<span class="sc">$</span>graphDescription1 <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="section-cb5-57"><a href="#section-cb5-57" tabindex="-1"></a>    <span class="st">&quot;1. Circle on the plot will zoom in to the selected period.&quot;</span></span>
<span id="section-cb5-58"><a href="#section-cb5-58" tabindex="-1"></a>  })</span>
<span id="section-cb5-59"><a href="#section-cb5-59" tabindex="-1"></a>  output<span class="sc">$</span>graphDescription2 <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="section-cb5-60"><a href="#section-cb5-60" tabindex="-1"></a>    <span class="st">&quot;2. Double click on the plot to restore axis.&quot;</span></span>
<span id="section-cb5-61"><a href="#section-cb5-61" tabindex="-1"></a>  })</span>
<span id="section-cb5-62"><a href="#section-cb5-62" tabindex="-1"></a>}</span></code></pre></div>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/yihuahuang1/multi-asset-strategy/edit/master/%s",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": false,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
